{"ast":null,"code":"import { FormGroup, FormControl } from '@angular/forms';\nimport { forkJoin } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/material/snack-bar\";\nimport * as i3 from \"@angular/forms\";\nimport * as i4 from \"@angular/common\";\n\nfunction AdminAddProductsComponent_option_34_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 25);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const category_r3 = ctx.$implicit;\n    i0.ɵɵpropertyInterpolate(\"value\", category_r3.name);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", category_r3.name, \" \");\n  }\n}\n\nfunction AdminAddProductsComponent_ng_container_38_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 26)(2, \"input\", 27);\n    i0.ɵɵlistener(\"change\", function AdminAddProductsComponent_ng_container_38_Template_input_change_2_listener($event) {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r5 = i0.ɵɵnextContext();\n      return ctx_r5.colorChanged($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"label\", 28);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const color_r4 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate(\"name\", color_r4.name);\n    i0.ɵɵpropertyInterpolate(\"id\", color_r4.name);\n    i0.ɵɵpropertyInterpolate(\"value\", color_r4.name);\n    i0.ɵɵadvance(1);\n    i0.ɵɵpropertyInterpolate(\"for\", color_r4.name);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", color_r4.name, \" \");\n  }\n}\n\nfunction AdminAddProductsComponent_ng_container_42_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 29)(2, \"input\", 27);\n    i0.ɵɵlistener(\"change\", function AdminAddProductsComponent_ng_container_42_Template_input_change_2_listener($event) {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r8 = i0.ɵɵnextContext();\n      return ctx_r8.sizeChanged($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"label\", 28);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const size_r7 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate(\"name\", size_r7.name);\n    i0.ɵɵpropertyInterpolate(\"id\", size_r7.name);\n    i0.ɵɵpropertyInterpolate(\"value\", size_r7.name);\n    i0.ɵɵadvance(1);\n    i0.ɵɵpropertyInterpolate(\"for\", size_r7.name);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", size_r7.name, \" \");\n  }\n}\n\nexport let AdminAddProductsComponent = /*#__PURE__*/(() => {\n  class AdminAddProductsComponent {\n    constructor(httpClient, snackBar) {\n      this.httpClient = httpClient;\n      this.snackBar = snackBar;\n      this.availableColors = [];\n      this.availableSizes = [];\n      this.availableCategories = [];\n      this.productForm = new FormGroup({\n        name: new FormControl(''),\n        mainImage: new FormControl(''),\n        quantityAvailable: new FormControl(''),\n        image2: new FormControl(''),\n        image3: new FormControl(''),\n        category: new FormControl(''),\n        description: new FormControl(''),\n        ngn: new FormControl(''),\n        usd: new FormControl('')\n      });\n      this.categoryNameToId = {};\n      this.colorSelectionMap = {};\n      this.sizeSelectionMap = {};\n    }\n\n    ngOnInit() {\n      const colorsRequest$ = this.httpClient.get('/api/colors');\n      const sizesRequest$ = this.httpClient.get('/api/sizes');\n      const productCategories$ = this.httpClient.get('/api/productCategories');\n      forkJoin([colorsRequest$, sizesRequest$, productCategories$]).pipe(map(([colors, sizes, productCategories]) => ({\n        colors,\n        sizes,\n        productCategories\n      }))).subscribe(({\n        colors,\n        sizes,\n        productCategories\n      }) => {\n        this.availableCategories = productCategories;\n        this.availableColors = colors;\n        this.availableSizes = sizes;\n\n        for (const color of this.availableColors) {\n          this.colorSelectionMap[color.name] = false;\n        }\n\n        for (const size of this.availableSizes) {\n          this.sizeSelectionMap[size.name] = false;\n        }\n\n        this.categoryNameToId = this.availableCategories.reduce((acc, curr) => {\n          acc[curr.name] = curr.id;\n          return acc;\n        }, {});\n      });\n    }\n\n    colorChanged(data) {\n      if (data.target.checked) {\n        this.colorSelectionMap[data.target.value] = true;\n      } else {\n        this.colorSelectionMap[data.target.value] = false;\n      }\n    }\n\n    sizeChanged(data) {\n      if (data.target.checked) {\n        this.sizeSelectionMap[data.target.value] = true;\n      } else {\n        this.sizeSelectionMap[data.target.value] = false;\n      }\n    }\n\n    clearInputs() {\n      this.productForm.reset();\n    }\n\n    showFormValues() {\n      console.log(this.productForm.controls);\n    }\n\n    isChecked(color, allColors) {\n      return allColors.includes(color);\n    }\n\n    get getMainImage() {\n      return this.productForm.controls.mainImage.value ? this.productForm.controls.mainImage.value : 'https://socialistmodernism.com/wp-content/uploads/2017/07/placeholder-image.png?w=640';\n    }\n\n    getImageByIndex(index) {\n      switch (index) {\n        case 1:\n          return this.productForm.controls.image2.value;\n\n        case 2:\n          return this.productForm.controls.image3.value;\n\n        default:\n          return this.productForm.controls.mainImage.value;\n      }\n    }\n\n    getSelectedColorIds() {\n      const selectedColors = [];\n\n      for (const aColor of this.availableColors) {\n        if (this.colorSelectionMap[aColor.name]) {\n          selectedColors.push(aColor.id);\n        }\n      }\n\n      return selectedColors;\n    }\n\n    getSelectedSizeIds() {\n      const selectedSizes = [];\n\n      for (const aSize of this.availableSizes) {\n        if (this.sizeSelectionMap[aSize.name]) {\n          selectedSizes.push(aSize.id);\n        }\n      }\n\n      return selectedSizes;\n    }\n\n    openWidget() {\n      console.log(cloudinary);\n    }\n\n    submitNewProduct() {\n      // Verify the presence of the required fields.\n      const formControls = this.productForm.controls;\n      const selectedColorIds = this.getSelectedColorIds();\n      const selectedSizeIds = this.getSelectedSizeIds();\n      let errorMessage = '';\n\n      if (!formControls.name.value) {\n        errorMessage = 'A name is required';\n      } else if (formControls.quantityAvailable.value === '' || formControls.quantityAvailable.value < 0 || formControls.quantityAvailable.value > 10000) {\n        errorMessage = 'Quantity available must be between 0 and 10000 (inclusive)';\n      } else if (!formControls.mainImage.value) {\n        errorMessage = 'A main image is required';\n      } else if (!formControls.description.value) {\n        errorMessage = 'A description is required';\n      } else if (!formControls.ngn.value || formControls.ngn.value < 0) {\n        errorMessage = 'An non-negative NGN price is required';\n      } else if (!formControls.usd.value || formControls.usd.value < 0) {\n        errorMessage = 'A non-negative USD price is required';\n      } else if (!formControls.category.value) {\n        errorMessage = 'A category must be selected';\n      } else if (selectedColorIds.length === 0) {\n        errorMessage = 'At least one color must be selected';\n      } else if (selectedSizeIds.length === 0) {\n        errorMessage = 'At least one size must be selected';\n      }\n\n      if (errorMessage) {\n        this.snackBar.open(errorMessage, 'Done', {\n          panelClass: ['warning-snackbar']\n        });\n        return;\n      }\n\n      const categoryId = this.categoryNameToId[formControls.category.value];\n      this.httpClient.post('/api/products/createProduct', {\n        token: '',\n        name: formControls.name.value,\n        quantityAvailable: formControls.quantityAvailable.value,\n        ngn: formControls.ngn.value,\n        usd: formControls.usd.value,\n        description: formControls.description.value,\n        categoryId: categoryId,\n        colors: selectedColorIds,\n        sizes: selectedSizeIds,\n        images: [this.productForm.controls.mainImage.value, this.productForm.controls.image2.value, this.productForm.controls.image3.value]\n      }).subscribe(data => {\n        if (data.message === 'success') {\n          this.snackBar.open('Successfully created product', 'Done', {\n            panelClass: ['success-snackbar']\n          });\n          return;\n        } else {\n          this.snackBar.open('An error occurred while trying to create the product', 'Done', {\n            panelClass: ['warning-snackbar']\n          });\n          return;\n        }\n      }, err => {\n        this.snackBar.open('An error occurred while trying to create the product', 'Done', {\n          panelClass: ['warning-snackbar']\n        });\n        return;\n      });\n    }\n\n  }\n\n  AdminAddProductsComponent.ɵfac = function AdminAddProductsComponent_Factory(t) {\n    return new (t || AdminAddProductsComponent)(i0.ɵɵdirectiveInject(i1.HttpClient), i0.ɵɵdirectiveInject(i2.MatSnackBar));\n  };\n\n  AdminAddProductsComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: AdminAddProductsComponent,\n    selectors: [[\"app-admin-add-products\"]],\n    decls: 46,\n    vars: 7,\n    consts: [[1, \"container-fluid\"], [1, \"comp-description\"], [1, \"new-product-holder\"], [1, \"restart-button\", 3, \"click\"], [1, \"new-product-form\", 3, \"formGroup\"], [2, \"text-align\", \"center\"], [2, \"width\", \"400px\", 3, \"src\"], [1, \"row\", \"product-alt-image-holder\"], [2, \"width\", \"150px\", 3, \"src\"], [2, \"display\", \"flex\", \"flex-direction\", \"column\"], [\"placeholder\", \"Product Name\", \"type\", \"text\", \"formControlName\", \"name\"], [\"placeholder\", \"Quantity Available\", \"type\", \"number\", \"formControlName\", \"quantityAvailable\"], [1, \"upload-iamge-container\"], [3, \"click\"], [\"placeholder\", \"Image URL 1\", \"type\", \"text\", \"formControlName\", \"mainImage\"], [\"placeholder\", \"Image URL 2\", \"type\", \"text\", \"formControlName\", \"image2\"], [\"placeholder\", \"Image URL 3\", \"type\", \"text\", \"formControlName\", \"image3\"], [\"placeholder\", \"Product Description\", \"formControlName\", \"description\"], [\"placeholder\", \"Naira Price\", \"type\", \"number\", \"formControlName\", \"ngn\"], [\"placeholder\", \"Dollar Price\", \"type\", \"number\", \"formControlName\", \"usd\"], [1, \"cat-label\"], [\"formControlName\", \"category\", \"name\", \"category\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [4, \"ngFor\", \"ngForOf\"], [1, \"save-product-button\", 3, \"click\"], [3, \"value\"], [2, \"display\", \"inline-block\", \"width\", \"clamp(60px, 25%, 200px)\"], [\"type\", \"checkbox\", 3, \"name\", \"id\", \"value\", \"change\"], [2, \"margin-left\", \"10px\", 3, \"for\"], [2, \"display\", \"inline-block\", \"width\", \"clamp(30px, 15%, 80px)\"]],\n    template: function AdminAddProductsComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"header\", 1)(2, \"span\");\n        i0.ɵɵtext(3, \" Add a new product \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(4, \"span\");\n        i0.ɵɵtext(5, \" - Add a new product to the site (The item name must be unique!) \");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(6, \"div\", 2)(7, \"div\")(8, \"button\", 3);\n        i0.ɵɵlistener(\"click\", function AdminAddProductsComponent_Template_button_click_8_listener() {\n          return ctx.clearInputs();\n        });\n        i0.ɵɵtext(9, \"RESTART\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(10, \"form\", 4)(11, \"div\", 5);\n        i0.ɵɵelement(12, \"img\", 6);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(13, \"div\", 7);\n        i0.ɵɵelement(14, \"img\", 8)(15, \"img\", 8);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(16, \"fieldset\", 9);\n        i0.ɵɵelement(17, \"input\", 10)(18, \"input\", 11);\n        i0.ɵɵelementStart(19, \"div\", 12)(20, \"button\", 13);\n        i0.ɵɵlistener(\"click\", function AdminAddProductsComponent_Template_button_click_20_listener() {\n          return ctx.openWidget();\n        });\n        i0.ɵɵtext(21, \"Upload Image\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(22, \"input\", 14);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(23, \"input\", 15)(24, \"input\", 16);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(25, \"fieldset\");\n        i0.ɵɵelement(26, \"textarea\", 17);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(27, \"fieldset\", 9);\n        i0.ɵɵelement(28, \"input\", 18)(29, \"input\", 19);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(30, \"fieldset\")(31, \"div\", 20);\n        i0.ɵɵtext(32, \"Category\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(33, \"select\", 21);\n        i0.ɵɵtemplate(34, AdminAddProductsComponent_option_34_Template, 2, 2, \"option\", 22);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(35, \"fieldset\")(36, \"div\", 20);\n        i0.ɵɵtext(37, \"Colors\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(38, AdminAddProductsComponent_ng_container_38_Template, 5, 5, \"ng-container\", 23);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(39, \"fieldset\")(40, \"div\", 20);\n        i0.ɵɵtext(41, \"Sizes\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(42, AdminAddProductsComponent_ng_container_42_Template, 5, 5, \"ng-container\", 23);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(43, \"div\", 5)(44, \"button\", 24);\n        i0.ɵɵlistener(\"click\", function AdminAddProductsComponent_Template_button_click_44_listener() {\n          return ctx.submitNewProduct();\n        });\n        i0.ɵɵtext(45, \" SAVE PRODUCT \");\n        i0.ɵɵelementEnd()()()()()();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(10);\n        i0.ɵɵproperty(\"formGroup\", ctx.productForm);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"src\", ctx.getMainImage, i0.ɵɵsanitizeUrl);\n        i0.ɵɵadvance(2);\n        i0.ɵɵpropertyInterpolate(\"src\", ctx.getImageByIndex(1), i0.ɵɵsanitizeUrl);\n        i0.ɵɵadvance(1);\n        i0.ɵɵpropertyInterpolate(\"src\", ctx.getImageByIndex(2), i0.ɵɵsanitizeUrl);\n        i0.ɵɵadvance(19);\n        i0.ɵɵproperty(\"ngForOf\", ctx.availableCategories);\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"ngForOf\", ctx.availableColors);\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"ngForOf\", ctx.availableSizes);\n      }\n    },\n    directives: [i3.ɵNgNoValidate, i3.NgControlStatusGroup, i3.FormGroupDirective, i3.DefaultValueAccessor, i3.NgControlStatus, i3.FormControlName, i3.NumberValueAccessor, i3.SelectControlValueAccessor, i4.NgForOf, i3.NgSelectOption, i3.ɵNgSelectMultipleOption],\n    styles: [\".new-product-holder[_ngcontent-%COMP%]{margin:40px 0;background-color:#fff;padding:20px;border:2px solid black;display:flex;justify-content:center}.new-product-holder[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{box-shadow:0 2px 12px 3px #f1f4f1;padding:30px;border-radius:4px;width:900px}.new-product-form[_ngcontent-%COMP%]{width:60%;margin:0 auto}.restart-button[_ngcontent-%COMP%]{width:100px;color:#fff;background-color:#fca5a5;border-radius:3px;transition:.2s;border:none}.restart-button[_ngcontent-%COMP%]:hover{background-color:#ec7d7d}.save-product-button[_ngcontent-%COMP%]{background-color:#5ea5f8;color:#fff;padding:10px 30px;border-radius:6px;margin-top:18px;transition:.2s;border:none}.save-product-button[_ngcontent-%COMP%]:hover{background-color:#4898f3}.upload-image-button[_ngcontent-%COMP%]{background-color:#b9babb;color:#000;padding:10px 30px;border-radius:6px;margin-top:18px;transition:.2s;border:none}.upload-iamge-container[_ngcontent-%COMP%]{display:flex}.upload-image-button[_ngcontent-%COMP%]:hover{background-color:#4898f3}input[type=text][_ngcontent-%COMP%], input[type=number][_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{margin:10px;padding:5px 5px 5px 10px;width:100%;outline:yellowgreen}\", \".comp-description[_ngcontent-%COMP%]{font-family:Lato;font-weight:200;background-color:#fff;padding:20px}.comp-description[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child{font-weight:500}header[_ngcontent-%COMP%]{border:2px solid black}.cat-label[_ngcontent-%COMP%]{color:#827f7f;font-weight:200}\"]\n  });\n  return AdminAddProductsComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}